"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2481],{41272:function(e,o,t){t.d(o,{nY:function(){return I}});var r=t(69887),n=t(55543),a=t(23614),i=t(44649),s=t(4786),c=t(26762),l=t(43291),u=t(59712),d=t(53357),T=t(87280);let k={getGasPriceInEther:(e,o)=>Number(o*e)/1e18,getGasPriceInUSD(e,o,t){let r=k.getGasPriceInEther(o,t);return a.C.bigNumber(e).times(r).toNumber()},getPriceImpact({sourceTokenAmount:e,sourceTokenPriceInUSD:o,toTokenPriceInUSD:t,toTokenAmount:r}){let n=a.C.bigNumber(e).times(o),i=a.C.bigNumber(r).times(t);return n.minus(i).div(n).times(100).toNumber()},getMaxSlippage(e,o){let t=a.C.bigNumber(e).div(100);return a.C.multiply(o,t).toNumber()},getProviderFee:(e,o=.0085)=>a.C.bigNumber(e).times(o).toString(),isInsufficientNetworkTokenForGas:(e,o)=>!!a.C.bigNumber(e).eq(0)||a.C.bigNumber(a.C.bigNumber(o||"0")).gt(e),isInsufficientSourceTokenForSwap(e,o,t){let r=t?.find(e=>e.address===o)?.quantity?.numeric;return a.C.bigNumber(r||"0").lt(e)},getToTokenAmount({sourceToken:e,toToken:o,sourceTokenPrice:t,toTokenPrice:r,sourceTokenAmount:n}){if("0"===n||!e||!o)return"0";let i=e.decimals,s=o.decimals;if(r<=0)return"0";let c=a.C.bigNumber(n).times(.0085),l=a.C.bigNumber(n).minus(c).times(a.C.bigNumber(10).pow(i)),u=a.C.bigNumber(t).div(r),d=i-s;return l.times(u).div(a.C.bigNumber(10).pow(d)).div(a.C.bigNumber(10).pow(s)).toFixed(s).toString()}};var g=t(59388),m=t(68584),p=t(72723),w=t(61704),b=t(6943),h=t(64369),S=t(35652),A=t(31929),v=t(86777),P=t(66909);let f={initializing:!1,initialized:!1,loadingPrices:!1,loadingQuote:!1,loadingApprovalTransaction:!1,loadingBuildTransaction:!1,loadingTransaction:!1,fetchError:!1,approvalTransaction:void 0,swapTransaction:void 0,transactionError:void 0,sourceToken:void 0,sourceTokenAmount:"",sourceTokenPriceInUSD:0,toToken:void 0,toTokenAmount:"",toTokenPriceInUSD:0,networkPrice:"0",networkBalanceInUSD:"0",networkTokenSymbol:"",inputError:void 0,slippage:u.bq.CONVERT_SLIPPAGE_TOLERANCE,tokens:void 0,popularTokens:void 0,suggestedTokens:void 0,foundTokens:void 0,myTokensWithBalance:void 0,tokensPriceMap:{},gasFee:"0",gasPriceInUSD:0,priceImpact:void 0,maxSlippage:void 0,providerFee:void 0},C=(0,r.sj)(f),y={state:C,subscribe:e=>(0,r.Ld)(C,()=>e(C)),subscribeKey:(e,o)=>(0,n.VW)(C,e,o),getParams(){let e=b.R.state.activeCaipAddress,o=d.j.getPlainAddress(e),t=(0,l.EO)(),r=S.ConnectorController.getConnectorId(b.R.state.activeChain);if(!o)throw Error("No address found to swap the tokens from.");let n=!C.toToken?.address||!C.toToken?.decimals,s=!C.sourceToken?.address||!C.sourceToken?.decimals||!a.C.bigNumber(C.sourceTokenAmount).gt(0),c=!C.sourceTokenAmount;return{networkAddress:t,fromAddress:o,fromCaipAddress:e,sourceTokenAddress:C.sourceToken?.address,toTokenAddress:C.toToken?.address,toTokenAmount:C.toTokenAmount,toTokenDecimals:C.toToken?.decimals,sourceTokenAmount:C.sourceTokenAmount,sourceTokenDecimals:C.sourceToken?.decimals,invalidToToken:n,invalidSourceToken:s,invalidSourceTokenAmount:c,availableToSwap:e&&!n&&!s&&!c,isAuthConnector:r===i.b.CONNECTOR_ID.AUTH}},setSourceToken(e){if(!e){C.sourceToken=e,C.sourceTokenAmount="",C.sourceTokenPriceInUSD=0;return}C.sourceToken=e,I.setTokenPrice(e.address,"sourceToken")},setSourceTokenAmount(e){C.sourceTokenAmount=e},setToToken(e){if(!e){C.toToken=e,C.toTokenAmount="",C.toTokenPriceInUSD=0;return}C.toToken=e,I.setTokenPrice(e.address,"toToken")},setToTokenAmount(e){C.toTokenAmount=e?a.C.formatNumberToLocalString(e,6):""},async setTokenPrice(e,o){let t=C.tokensPriceMap[e]||0;t||(C.loadingPrices=!0,t=await I.getAddressPrice(e)),"sourceToken"===o?C.sourceTokenPriceInUSD=t:"toToken"===o&&(C.toTokenPriceInUSD=t),C.loadingPrices&&(C.loadingPrices=!1),I.getParams().availableToSwap&&I.swapTokens()},switchTokens(){if(C.initializing||!C.initialized)return;let e=C.toToken?{...C.toToken}:void 0,o=C.sourceToken?{...C.sourceToken}:void 0,t=e&&""===C.toTokenAmount?"1":C.toTokenAmount;I.setSourceToken(e),I.setToToken(o),I.setSourceTokenAmount(t),I.setToTokenAmount(""),I.swapTokens()},resetState(){C.myTokensWithBalance=f.myTokensWithBalance,C.tokensPriceMap=f.tokensPriceMap,C.initialized=f.initialized,C.sourceToken=f.sourceToken,C.sourceTokenAmount=f.sourceTokenAmount,C.sourceTokenPriceInUSD=f.sourceTokenPriceInUSD,C.toToken=f.toToken,C.toTokenAmount=f.toTokenAmount,C.toTokenPriceInUSD=f.toTokenPriceInUSD,C.networkPrice=f.networkPrice,C.networkTokenSymbol=f.networkTokenSymbol,C.networkBalanceInUSD=f.networkBalanceInUSD,C.inputError=f.inputError,C.myTokensWithBalance=f.myTokensWithBalance},resetValues(){let{networkAddress:e}=I.getParams(),o=C.tokens?.find(o=>o.address===e);I.setSourceToken(o),I.setToToken(void 0)},getApprovalLoadingState:()=>C.loadingApprovalTransaction,clearError(){C.transactionError=void 0},async initializeState(){if(!C.initializing){if(C.initializing=!0,!C.initialized)try{await I.fetchTokens(),C.initialized=!0}catch(e){C.initialized=!1,P.SnackController.showError("Failed to initialize swap"),v.RouterController.goBack()}C.initializing=!1}},async fetchTokens(){let{networkAddress:e}=I.getParams();await I.getTokenList(),await I.getNetworkTokenPrice(),await I.getMyTokensWithBalance();let o=C.tokens?.find(o=>o.address===e);o&&(C.networkTokenSymbol=o.symbol,I.setSourceToken(o),I.setSourceTokenAmount("1"))},async getTokenList(){let e=await T.n.getTokenList();C.tokens=e,C.popularTokens=e.sort((e,o)=>e.symbol<o.symbol?-1:e.symbol>o.symbol?1:0),C.suggestedTokens=e.filter(e=>!!u.bq.SWAP_SUGGESTED_TOKENS.includes(e.symbol),{})},async getAddressPrice(e){let o=C.tokensPriceMap[e];if(o)return o;let t=await w.L.fetchTokenPrice({addresses:[e]}),r=t?.fungibles||[],n=[...C.tokens||[],...C.myTokensWithBalance||[]],a=n?.find(o=>o.address===e)?.symbol,i=parseFloat((r.find(e=>e.symbol.toLowerCase()===a?.toLowerCase())?.price||0).toString());return C.tokensPriceMap[e]=i,i},async getNetworkTokenPrice(){let{networkAddress:e}=I.getParams(),o=await w.L.fetchTokenPrice({addresses:[e]}).catch(()=>(P.SnackController.showError("Failed to fetch network token price"),{fungibles:[]})),t=o.fungibles?.[0],r=t?.price.toString()||"0";C.tokensPriceMap[e]=parseFloat(r),C.networkTokenSymbol=t?.symbol||"",C.networkPrice=r},async getMyTokensWithBalance(e){let o=await c.Q.getMyTokensWithBalance(e),t=T.n.mapBalancesToSwapTokens(o);t&&(await I.getInitialGasPrice(),I.setBalances(t))},setBalances(e){let{networkAddress:o}=I.getParams(),t=b.R.state.activeCaipNetwork;if(!t)return;let r=e.find(e=>e.address===o);e.forEach(e=>{C.tokensPriceMap[e.address]=e.price||0}),C.myTokensWithBalance=e.filter(e=>e.address.startsWith(t.caipNetworkId)),C.networkBalanceInUSD=r?a.C.multiply(r.quantity.numeric,r.price).toString():"0"},async getInitialGasPrice(){let e=await T.n.fetchGasPrice();if(!e)return{gasPrice:null,gasPriceInUSD:null};switch(b.R.state?.activeCaipNetwork?.chainNamespace){case i.b.CHAIN.SOLANA:return C.gasFee=e.standard??"0",C.gasPriceInUSD=a.C.multiply(e.standard,C.networkPrice).div(1e9).toNumber(),{gasPrice:BigInt(C.gasFee),gasPriceInUSD:Number(C.gasPriceInUSD)};case i.b.CHAIN.EVM:default:let o=e.standard??"0",t=BigInt(o),r=BigInt(15e4),n=k.getGasPriceInUSD(C.networkPrice,r,t);return C.gasFee=o,C.gasPriceInUSD=n,{gasPrice:t,gasPriceInUSD:n}}},async swapTokens(){let e=m.N.state.address,o=C.sourceToken,t=C.toToken,r=a.C.bigNumber(C.sourceTokenAmount).gt(0);if(r||I.setToTokenAmount(""),!t||!o||C.loadingPrices||!r)return;C.loadingQuote=!0;let n=a.C.bigNumber(C.sourceTokenAmount).times(10**o.decimals).round(0);try{let r=await w.L.fetchSwapQuote({userAddress:e,from:o.address,to:t.address,gasPrice:C.gasFee,amount:n.toString()});C.loadingQuote=!1;let i=r?.quotes?.[0]?.toAmount;if(!i){p.AlertController.open({shortMessage:"Incorrect amount",longMessage:"Please enter a valid amount"},"error");return}let s=a.C.bigNumber(i).div(10**t.decimals).toString();I.setToTokenAmount(s),I.hasInsufficientToken(C.sourceTokenAmount,o.address)?C.inputError="Insufficient balance":(C.inputError=void 0,I.setTransactionDetails())}catch(e){C.loadingQuote=!1,C.inputError="Insufficient balance"}},async getTransaction(){let{fromCaipAddress:e,availableToSwap:o}=I.getParams(),t=C.sourceToken,r=C.toToken;if(e&&o&&t&&r&&!C.loadingQuote)try{let o;return C.loadingBuildTransaction=!0,o=await T.n.fetchSwapAllowance({userAddress:e,tokenAddress:t.address,sourceTokenAmount:C.sourceTokenAmount,sourceTokenDecimals:t.decimals})?await I.createSwapTransaction():await I.createAllowanceTransaction(),C.loadingBuildTransaction=!1,C.fetchError=!1,o}catch(e){v.RouterController.goBack(),P.SnackController.showError("Failed to check allowance"),C.loadingBuildTransaction=!1,C.approvalTransaction=void 0,C.swapTransaction=void 0,C.fetchError=!0;return}},async createAllowanceTransaction(){let{fromCaipAddress:e,sourceTokenAddress:o,toTokenAddress:t}=I.getParams();if(e&&t){if(!o)throw Error("createAllowanceTransaction - No source token address found.");try{let r=await w.L.generateApproveCalldata({from:o,to:t,userAddress:e}),n=d.j.getPlainAddress(r.tx.from);if(!n)throw Error("SwapController:createAllowanceTransaction - address is required");let a={data:r.tx.data,to:n,gasPrice:BigInt(r.tx.eip155.gasPrice),value:BigInt(r.tx.value),toAmount:C.toTokenAmount};return C.swapTransaction=void 0,C.approvalTransaction={data:a.data,to:a.to,gasPrice:a.gasPrice,value:a.value,toAmount:a.toAmount},{data:a.data,to:a.to,gasPrice:a.gasPrice,value:a.value,toAmount:a.toAmount}}catch(e){v.RouterController.goBack(),P.SnackController.showError("Failed to create approval transaction"),C.approvalTransaction=void 0,C.swapTransaction=void 0,C.fetchError=!0;return}}},async createSwapTransaction(){let{networkAddress:e,fromCaipAddress:o,sourceTokenAmount:t}=I.getParams(),r=C.sourceToken,n=C.toToken;if(!o||!t||!r||!n)return;let a=h.ConnectionController.parseUnits(t,r.decimals)?.toString();try{let t=await w.L.generateSwapCalldata({userAddress:o,from:r.address,to:n.address,amount:a,disableEstimate:!0}),i=r.address===e,s=BigInt(t.tx.eip155.gas),c=BigInt(t.tx.eip155.gasPrice),l=d.j.getPlainAddress(t.tx.to);if(!l)throw Error("SwapController:createSwapTransaction - address is required");let u={data:t.tx.data,to:l,gas:s,gasPrice:c,value:i?BigInt(a??"0"):BigInt("0"),toAmount:C.toTokenAmount};return C.gasPriceInUSD=k.getGasPriceInUSD(C.networkPrice,s,c),C.approvalTransaction=void 0,C.swapTransaction=u,u}catch(e){v.RouterController.goBack(),P.SnackController.showError("Failed to create transaction"),C.approvalTransaction=void 0,C.swapTransaction=void 0,C.fetchError=!0;return}},async sendTransactionForApproval(e){let{fromAddress:o,isAuthConnector:t}=I.getParams();C.loadingApprovalTransaction=!0;let r="Approve limit increase in your wallet";t?v.RouterController.pushTransactionStack({onSuccess(){P.SnackController.showLoading(r)}}):P.SnackController.showLoading(r);try{await h.ConnectionController.sendTransaction({address:o,to:e.to,data:e.data,value:e.value,chainNamespace:i.b.CHAIN.EVM}),await I.swapTokens(),await I.getTransaction(),C.approvalTransaction=void 0,C.loadingApprovalTransaction=!1}catch(e){C.transactionError=e?.shortMessage,C.loadingApprovalTransaction=!1,P.SnackController.showError(e?.shortMessage||"Transaction error"),A.X.sendEvent({type:"track",event:"SWAP_APPROVAL_ERROR",properties:{message:e?.shortMessage||e?.message||"Unknown",network:b.R.state.activeCaipNetwork?.caipNetworkId||"",swapFromToken:I.state.sourceToken?.symbol||"",swapToToken:I.state.toToken?.symbol||"",swapFromAmount:I.state.sourceTokenAmount||"",swapToAmount:I.state.toTokenAmount||"",isSmartAccount:(0,l.r9)(i.b.CHAIN.EVM)===s.y_.ACCOUNT_TYPES.SMART_ACCOUNT}})}},async sendTransactionForSwap(e){if(!e)return;let{fromAddress:o,toTokenAmount:t,isAuthConnector:r}=I.getParams();C.loadingTransaction=!0;let n=`Swapping ${C.sourceToken?.symbol} to ${a.C.formatNumberToLocalString(t,3)} ${C.toToken?.symbol}`,c=`Swapped ${C.sourceToken?.symbol} to ${a.C.formatNumberToLocalString(t,3)} ${C.toToken?.symbol}`;r?v.RouterController.pushTransactionStack({onSuccess(){v.RouterController.replace("Account"),P.SnackController.showLoading(n),y.resetState()}}):P.SnackController.showLoading("Confirm transaction in your wallet");try{let t=[C.sourceToken?.address,C.toToken?.address].join(","),n=await h.ConnectionController.sendTransaction({address:o,to:e.to,data:e.data,value:e.value,chainNamespace:i.b.CHAIN.EVM});return C.loadingTransaction=!1,P.SnackController.showSuccess(c),A.X.sendEvent({type:"track",event:"SWAP_SUCCESS",properties:{network:b.R.state.activeCaipNetwork?.caipNetworkId||"",swapFromToken:I.state.sourceToken?.symbol||"",swapToToken:I.state.toToken?.symbol||"",swapFromAmount:I.state.sourceTokenAmount||"",swapToAmount:I.state.toTokenAmount||"",isSmartAccount:(0,l.r9)(i.b.CHAIN.EVM)===s.y_.ACCOUNT_TYPES.SMART_ACCOUNT}}),y.resetState(),r||v.RouterController.replace("Account"),y.getMyTokensWithBalance(t),n}catch(e){C.transactionError=e?.shortMessage,C.loadingTransaction=!1,P.SnackController.showError(e?.shortMessage||"Transaction error"),A.X.sendEvent({type:"track",event:"SWAP_ERROR",properties:{message:e?.shortMessage||e?.message||"Unknown",network:b.R.state.activeCaipNetwork?.caipNetworkId||"",swapFromToken:I.state.sourceToken?.symbol||"",swapToToken:I.state.toToken?.symbol||"",swapFromAmount:I.state.sourceTokenAmount||"",swapToAmount:I.state.toTokenAmount||"",isSmartAccount:(0,l.r9)(i.b.CHAIN.EVM)===s.y_.ACCOUNT_TYPES.SMART_ACCOUNT}});return}},hasInsufficientToken:(e,o)=>k.isInsufficientSourceTokenForSwap(e,o,C.myTokensWithBalance),setTransactionDetails(){let{toTokenAddress:e,toTokenDecimals:o}=I.getParams();e&&o&&(C.gasPriceInUSD=k.getGasPriceInUSD(C.networkPrice,BigInt(C.gasFee),BigInt(15e4)),C.priceImpact=k.getPriceImpact({sourceTokenAmount:C.sourceTokenAmount,sourceTokenPriceInUSD:C.sourceTokenPriceInUSD,toTokenPriceInUSD:C.toTokenPriceInUSD,toTokenAmount:C.toTokenAmount}),C.maxSlippage=k.getMaxSlippage(C.slippage,C.toTokenAmount),C.providerFee=k.getProviderFee(C.sourceTokenAmount))}},I=(0,g.P)(y)},4594:function(e,o,t){t(95137)},64349:function(e,o,t){t(4163)},7060:function(e,o,t){var r=t(31133),n=t(84927);t(23805),t(18360);var a=t(84249),i=t(57116);t(1736);var s=(0,r.iv)`
  :host {
    display: block;
  }

  :host > button {
    gap: var(--wui-spacing-xxs);
    padding: var(--wui-spacing-xs);
    padding-right: var(--wui-spacing-1xs);
    height: 40px;
    border-radius: var(--wui-border-radius-l);
    background: var(--wui-color-gray-glass-002);
    border-width: 0px;
    box-shadow: inset 0 0 0 1px var(--wui-color-gray-glass-002);
  }

  :host > button wui-image {
    width: 24px;
    height: 24px;
    border-radius: var(--wui-border-radius-s);
    box-shadow: inset 0 0 0 1px var(--wui-color-gray-glass-010);
  }
`,c=function(e,o,t,r){var n,a=arguments.length,i=a<3?o:null===r?r=Object.getOwnPropertyDescriptor(o,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,o,t,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(o,t,i):n(o,t))||i);return a>3&&i&&Object.defineProperty(o,t,i),i};let l=class extends r.oi{constructor(){super(...arguments),this.text=""}render(){return(0,r.dy)`
      <button>
        ${this.tokenTemplate()}
        <wui-text variant="paragraph-600" color="fg-100">${this.text}</wui-text>
      </button>
    `}tokenTemplate(){return this.imageSrc?(0,r.dy)`<wui-image src=${this.imageSrc}></wui-image>`:(0,r.dy)`
      <wui-icon-box
        size="sm"
        iconColor="fg-200"
        backgroundColor="fg-300"
        icon="networkPlaceholder"
      ></wui-icon-box>
    `}};l.styles=[a.ET,a.ZM,s],c([(0,n.Cb)()],l.prototype,"imageSrc",void 0),c([(0,n.Cb)()],l.prototype,"text",void 0),c([(0,i.M)("wui-token-button")],l)},23805:function(e,o,t){var r=t(31133),n=t(84927),a=t(84249),i=t(57116),s=(0,r.iv)`
  :host {
    display: block;
    width: var(--local-width);
    height: var(--local-height);
  }

  :host([data-object-fit='cover']) img {
    object-fit: cover;
    object-position: center center;
  }

  :host([data-object-fit='contain']) img {
    object-fit: contain;
    object-position: center center;
  }

  img {
    display: block;
    width: 100%;
    height: 100%;
    border-radius: inherit;
  }
`,c=function(e,o,t,r){var n,a=arguments.length,i=a<3?o:null===r?r=Object.getOwnPropertyDescriptor(o,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,o,t,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a<3?n(i):a>3?n(o,t,i):n(o,t))||i);return a>3&&i&&Object.defineProperty(o,t,i),i};let l=class extends r.oi{constructor(){super(...arguments),this.src="./path/to/image.jpg",this.alt="Image",this.size=void 0,this.objectFit="cover"}render(){return this.objectFit&&(this.dataset.objectFit=this.objectFit),this.style.cssText=`
      --local-width: ${this.size?`var(--wui-icon-size-${this.size});`:"100%"};
      --local-height: ${this.size?`var(--wui-icon-size-${this.size});`:"100%"};
      `,(0,r.dy)`<img src=${this.src} alt=${this.alt} @error=${this.handleImageError} />`}handleImageError(){this.dispatchEvent(new CustomEvent("onLoadError",{bubbles:!0,composed:!0}))}};l.styles=[a.ET,a.Bp,s],c([(0,n.Cb)()],l.prototype,"src",void 0),c([(0,n.Cb)()],l.prototype,"alt",void 0),c([(0,n.Cb)()],l.prototype,"size",void 0),c([(0,n.Cb)()],l.prototype,"objectFit",void 0),c([(0,i.M)("wui-image")],l)}}]);